import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import { redirect } from 'next/navigation';

import styles from '@/styles/layout/layout.module.css';
import Header from '@/components/layout/Header/header';
import Footer from '@/components/layout/footer';
import Sidebar from '@/components/layout/sidebar';
import { currentUserId } from '@/lib/auth';
import { getUserById } from '@/data/user';
import { getUserCourses } from '@/actions/userCourse';
import { getNotifications } from '@/actions/notifications';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const userId = await currentUserId();
  if (!userId) return redirect('/');

  const courses = await getUserCourses(userId);
  if (!courses) return redirect('/');

  const notifications = await getNotifications();
  if (!notifications) return redirect('/');

  const user = await getUserById(userId);
  if (!user) return redirect('/');

  return (
    <div className={styles['wrapper']}>
      <Header
        user={user}
        courses={courses}
        notifications={notifications}
      />

      <div className={styles['body']}>
        <Sidebar />
        <div className={styles['content']}>{children}</div>
      </div>

      <Footer />
    </div>
  );
}
